<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>MainPage</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
</head>
<body>

        <h3>VIDEO tag and MediaSource API</h3>

<div class="container">

    <video autoplay muted id="player" controls>
    </video>

</div>

<script src="js/jquery-3.3.1.slim.min.js"></script>
<script src="js/popper.min.js"></script>
<script src="js/bootstrap.min.js"></script>

<script>

var videoPlayer = document.getElementById('player');
var medSource = new MediaSource;

get_video_chunk("http://localhost:9090/server/video?id=b2.webm")
    .then(function(buf){
        var arrayBuffer = event.target.result;
        videoPlayer.src = URL.createObjectURL(medSource);
        medSource.addEventListener('sourceopen', 
            function(){
                var sourceBuffer = medSource.addSourceBuffer('video/webm; codecs="vorbis, vp8"');
                sourceBuffer.addEventListener('updateend', function () {
                    medSource.endOfStream();
                    videoPlayer.play();
                });
                sourceBuffer.appendBuffer(buf);
            }
        );
    })
    .catch(function(reject){
        alert("Something went wrong" +reject)
});


function get_video_chunk(url){
    return new Promise(function(resolve, reject){
        var httpRequest = new XMLHttpRequest();
        httpRequest.open("GET", url);
        httpRequest.responseType = "arraybuffer";

        httpRequest.onload = function() {
          resolve(httpRequest.response);
        };

        httpRequest.onerror = reject;
        httpRequest.send();
    });
}
</script>
</body>
</html>